<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>iPod Classic PRO MAX Retro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin:0; height:100%; overflow:hidden; touch-action:none; background:#cfd4d8; display:flex; justify-content:center; align-items:center; }
    .ipod-shell { width:300px; height:540px; background:linear-gradient(to bottom,#ddd,#aaa); border-radius:40px; box-shadow:inset 0 0 10px rgba(0,0,0,0.4), 0 10px 30px rgba(0,0,0,0.4); display:flex; flex-direction:column; align-items:center; padding:20px; position:relative; }
    .ipod-screen { width:240px; height:220px; background:radial-gradient(circle at 30% 30%,#e0f1f5 0%,#b3cbd4 100%); border:4px solid #333; border-radius:14px; box-shadow:inset 0 0 15px rgba(0,0,0,0.3); overflow:auto; font-size:12px; padding:10px; }
    .ipod-screen.off { background:#000; color:#fff; display:flex; justify-content:center; align-items:center; }
    .status-bar { font-size:10px; display:flex; justify-content:space-between; margin-bottom:6px; }
    .screen-item { padding:4px; border-radius:4px; }
    .screen-item.selected { background:#007aff; color:#fff; }
    .clickwheel { width:180px; height:180px; background:radial-gradient(circle,#ddd,#999); border-radius:50%; margin-top:auto; position:relative; box-shadow:inset 0 0 25px rgba(0,0,0,0.4); }
    .btn { position:absolute; font-size:10px; font-weight:bold; }
    .btn.menu { top:12px; left:50%; transform:translateX(-50%); }
    .btn.back { left:10px; top:50%; transform:translateY(-50%); }
    .btn.forward { right:10px; top:50%; transform:translateY(-50%); }
    .btn.play { bottom:12px; left:50%; transform:translateX(-50%); }
    .center-button { width:60px; height:60px; border-radius:50%; background:#555; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); cursor:pointer; box-shadow:inset 0 0 8px rgba(0,0,0,0.3); }
    .volume-btn { position:absolute; width:20px; height:40px; background:#666; border-radius:10px; cursor:pointer; box-shadow:0 0 5px rgba(0,0,0,0.5); }
    .volume-up { left:-30px; top:150px; }
    .volume-down { left:-30px; top:200px; }
    .now-playing-bar { font-size:10px; position:absolute; bottom:-20px; left:50%; transform:translateX(-50%); text-align:center; }
    .equalizer div { display:inline-block; width:3px; background:#007aff; margin:0 1px; height:5px; animation:bounce 1s infinite alternate; }
    .equalizer div:nth-child(2) { animation-delay:0.2s; }
    .equalizer div:nth-child(3) { animation-delay:0.4s; }
    @keyframes bounce { from {height:4px;} to {height:10px;} }
    .gallery-photo { width:100%; border-radius:6px; margin:5px 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const {useState,useEffect,useRef} = React;
    function App(){
      const [username,setUsername] = useState('');
      const [pin,setPin] = useState('');
      const [loggedIn,setLoggedIn] = useState(false);
      const [screen,setScreen] = useState('menu');
      const [selected,setSelected] = useState(0);
      const [songs,setSongs] = useState([]);
      const [videos,setVideos] = useState([]);
      const [photos,setPhotos] = useState([]);
      const [queue,setQueue] = useState([]);
      const [current,setCurrent] = useState(null);
      const [playing,setPlaying] = useState(false);
      const [volume,setVolume] = useState(0.5);
      const [screenOff,setScreenOff] = useState(false);
      const fileInputRef = useRef();
      const videoCamRef = useRef();
      const audioRef = useRef();
      const listRef = useRef();
      const lastAngle = useRef(null);
      const menuItems = ['Ver Cola','A√±adir M√∫sica','A√±adir Video','Biblioteca M√∫sica','Biblioteca Videos','C√°mara Retro','Configuraci√≥n'];

      const vibrate = () => { if(navigator.vibrate) navigator.vibrate(30); };
      const handleLogin = ()=>{ if(username.trim()===''||pin.length!==4){alert('Usuario y PIN requeridos'); return;} setLoggedIn(true); };
      const saveData = ()=>{ localStorage.setItem(`${username}_${pin}_songs`,JSON.stringify(songs)); localStorage.setItem(`${username}_${pin}_videos`,JSON.stringify(videos)); localStorage.setItem(`${username}_${pin}_photos`,JSON.stringify(photos)); };
      useEffect(()=>{ if(loggedIn){ setSongs(JSON.parse(localStorage.getItem(`${username}_${pin}_songs`)||'[]')); setVideos(JSON.parse(localStorage.getItem(`${username}_${pin}_videos`)||'[]')); setPhotos(JSON.parse(localStorage.getItem(`${username}_${pin}_photos`)||'[]')); } },[loggedIn]);

      const nextItem = ()=>{ setSelected((s)=>s+1>=menuItems.length?0:s+1); vibrate(); };
      const prevItem = ()=>{ setSelected((s)=>s-1<0?menuItems.length-1:s-1); vibrate(); };
      const onRotate = (e)=>{
        const rect = e.currentTarget.getBoundingClientRect();
        const cx = rect.left+rect.width/2, cy = rect.top+rect.height/2;
        const x = e.clientX || e.touches?.[0].clientX, y = e.clientY || e.touches?.[0].clientY;
        const angle = Math.atan2(y-cy,x-cx)*180/Math.PI;
        if(lastAngle.current!==null){
          let delta = angle - lastAngle.current;
          if(delta>180) delta-=360; if(delta<-180) delta+=360;
          if(Math.abs(delta)>15){ delta>0?nextItem():prevItem(); }
        }
        lastAngle.current=angle;
      };

      const selectItem = ()=>{
        vibrate();
        switch(screen){
          case 'menu': const item = menuItems[selected]; if(item==='Ver Cola') setScreen('queue'); else if(item==='A√±adir M√∫sica') openFilePicker('audio/*'); else if(item==='A√±adir Video') openFilePicker('video/*'); else if(item==='Biblioteca M√∫sica') setScreen('librarySongs'); else if(item==='Biblioteca Videos') setScreen('libraryVideos'); else if(item==='C√°mara Retro') startCamera(); else if(item==='Configuraci√≥n') setScreen('settings'); break;
          case 'queue': if(queue.length>0) { setCurrent(queue[selected]); setPlaying(true); }
        }
      };

      const openFilePicker=(accept)=>{ if(fileInputRef.current){ fileInputRef.current.accept=accept; fileInputRef.current.multiple=true; fileInputRef.current.click(); } };
      const onFilesSelected=(e)=>{ const files=[...e.target.files]; files.forEach(f=>{ const url=URL.createObjectURL(f); const name=f.name; if(f.type.startsWith('audio')) setSongs(prev=>{const all=[...prev,{name,url}]; saveData(); return all;}); if(f.type.startsWith('video')) setVideos(prev=>{const all=[...prev,{name,url}]; saveData(); return all;}); }); };
      const startCamera=()=>{ setScreen('camera'); navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{ videoCamRef.current.srcObject=stream; videoCamRef.current.play(); }).catch(()=>alert('No se pudo abrir c√°mara')); };
      const takePhoto=()=>{ const canvas=document.createElement('canvas'); const video=videoCamRef.current; canvas.width=video.videoWidth; canvas.height=video.videoHeight; const ctx=canvas.getContext('2d'); ctx.filter='grayscale(1)'; ctx.drawImage(video,0,0); const dataUrl=canvas.toDataURL(); setPhotos(p=>{const all=[...p,dataUrl]; saveData(); return all;}); };
      const volUp=()=>{ setVolume(v=>Math.min(1,v+0.1)); vibrate(); };
      const volDown=()=>{ setVolume(v=>Math.max(0,v-0.1)); vibrate(); };
      const renderScreen=()=>{ if(screen==='menu') return menuItems.map((m,i)=><div key={i} className={`screen-item ${selected===i?'selected':''}`}>{m}</div>); if(screen==='queue') return queue.map((q,i)=><div key={i} className={`screen-item ${selected===i?'selected':''}`}>{q.name}</div>); if(screen==='librarySongs') return songs.map((s,i)=><div key={i} className={`screen-item`}>{s.name}</div>); if(screen==='libraryVideos') return videos.map((v,i)=><div key={i} className={`screen-item`}>{v.name}</div>); if(screen==='camera') return <><video ref={videoCamRef} width="100%" autoPlay muted playsInline></video><button onClick={takePhoto}>üì∏</button></>; };

      if(!loggedIn) return <div><input placeholder="Usuario" value={username} onChange={e=>setUsername(e.target.value)}/><input placeholder="PIN" maxLength="4" value={pin} onChange={e=>setPin(e.target.value.replace(/\D/g,''))}/><button onClick={handleLogin}>Entrar</button></div>;
      return <div className="ipod-shell">
        <div className="ipod-screen">{renderScreen()}</div>
        <input ref={fileInputRef} style={{display:'none'}} type="file" onChange={onFilesSelected} />
        <div className="clickwheel" onMouseDown={onRotate} onTouchStart={onRotate}>
          <div className="btn menu" onClick={()=>setScreen('menu')}>MENU</div>
          <div className="btn back" onClick={()=>{setScreen('menu');}}>‚Üê</div>
          <div className="btn forward" onClick={()=>{}}>‚Üí</div>
          <div className="btn play" onClick={()=>{setPlaying(!playing);}}>‚ñ∂Ô∏è</div>
          <div className="center-button" onClick={selectItem}></div>
        </div>
        <div className="volume-btn volume-up" onClick={volUp}>+</div>
        <div className="volume-btn volume-down" onClick={volDown}>-</div>
      </div>;
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
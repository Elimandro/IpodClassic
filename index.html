<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>iPod Classic Clone - Admin Ready</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- React + Babel CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #ddd;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .ipod-shell {
      width: 300px;
      height: 520px;
      background: #f8f8f8;
      border-radius: 40px;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.3), 0 8px 20px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: relative;
    }
    .ipod-screen {
      width: 240px;
      height: 200px;
      background: radial-gradient(circle at 30% 30%, #e0f1f5 0%, #b3cbd4 100%);
      border: 4px solid #333;
      border-radius: 14px;
      box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
      position: relative;
      padding: 10px;
      overflow: hidden;
      font-size: 12px;
    }
    .ipod-screen::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(0deg, transparent 0 2px, rgba(0,0,0,0.03) 2px 3px);
      pointer-events: none;
      border-radius: 14px;
    }
    .battery {
      position: absolute;
      top: 6px;
      right: 12px;
      font-size: 10px;
    }
    .screen-item { padding: 4px; border-radius: 4px; }
    .screen-item.selected { background: #007aff; color: #fff; }
    .now-playing, iframe { width: 100%; }
    .progress-bar { width: 100%; height: 4px; background: #ccc; margin-top: 8px; border-radius: 2px; }
    .progress { height: 100%; background: #007aff; border-radius: 2px; width: 0%; }
    .clickwheel {
      width: 180px; height: 180px;
      background: radial-gradient(circle at center, #ddd 0%, #999 90%);
      border-radius: 50%;
      margin-top: auto; position: relative;
      box-shadow: inset 0 0 25px rgba(0,0,0,0.4);
    }
    .clickwheel::before {
      content: ''; position: absolute; inset: 0; border-radius: 50%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.2) 0%, transparent 70%);
    }
    .clickwheel .btn {
      position: absolute; font-size: 10px; font-weight: bold; color: #333;
    }
    .btn.menu { top: 12px; left: 50%; transform: translateX(-50%); }
    .btn.back { left: 10px; top: 50%; transform: translateY(-50%); }
    .btn.forward { right: 10px; top: 50%; transform: translateY(-50%); }
    .btn.play { bottom: 12px; left: 50%; transform: translateX(-50%); }
    .center-button {
      width: 60px; height: 60px; border-radius: 50%; background: #555;
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%); cursor: pointer;
      box-shadow: inset 0 0 8px rgba(0,0,0,0.3);
    }
    input, button { margin: 2px 0; font-size: 12px; width: 100%; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function App() {
      const [pin, setPin] = useState('');
      const [loggedIn, setLoggedIn] = useState(false);
      const [battery, setBattery] = useState('--%');
      const [screen, setScreen] = useState('menu');
      const [selected, setSelected] = useState(0);
      const [songs, setSongs] = useState([]);
      const [videos, setVideos] = useState([]);
      const [current, setCurrent] = useState(null);
      const [currentVideo, setCurrentVideo] = useState(null);
      const [playing, setPlaying] = useState(false);
      const audioRef = useRef(null);
      const [progress, setProgress] = useState(0);
      const titleRef = useRef();
      const urlRef = useRef();

      useEffect(() => {
        if (loggedIn && 'getBattery' in navigator) {
          navigator.getBattery().then(bat => {
            setBattery(`${Math.round(bat.level*100)}%`);
            bat.addEventListener('levelchange', () => {
              setBattery(`${Math.round(bat.level*100)}%`);
            });
          });
        }
      }, [loggedIn]);

      useEffect(() => {
        if (pin) {
          const s = localStorage.getItem(`${pin}_songs`);
          const v = localStorage.getItem(`${pin}_videos`);
          setSongs(s ? JSON.parse(s) : []);
          setVideos(v ? JSON.parse(v) : []);
        }
      }, [pin]);

      useEffect(() => {
        if (audioRef.current) {
          audioRef.current.ontimeupdate = () => {
            setProgress(audioRef.current.duration ? audioRef.current.currentTime / audioRef.current.duration : 0);
          };
        }
      }, [current]);

      const saveData = () => {
        localStorage.setItem(`${pin}_songs`, JSON.stringify(songs));
        localStorage.setItem(`${pin}_videos`, JSON.stringify(videos));
      };

      const handleLogin = () => {
        if (/^\d{4}$/.test(pin)) {
          setLoggedIn(true);
          setScreen('menu');
          setSelected(0);
        } else {
          alert('PIN inv√°lido: solo 4 d√≠gitos num√©ricos');
        }
      };

      const renderScreen = () => {
        if (screen === 'menu') {
          const items = [
            '‚ñ∂ Biblioteca M√∫sica',
            '‚ñ∂ Biblioteca Videos',
            '+ A√±adir M√∫sica',
            '+ A√±adir Video',
            '‚õî Borrar Todo'
          ];
          if (pin === '0000') items.push('üóëÔ∏è Admin - Borrar PINs');
          return items.map((item, i) =>
            <div key={i} className={`screen-item ${i===selected?'selected':''}`}>{item}</div>);
        }
        if (screen === 'libraryMusic') {
          return songs.length === 0 ? <div>No hay m√∫sica.</div> :
            songs.map((s,i)=>
              <div key={i} className={`screen-item ${i===selected?'selected':''}`}>
                {s.title} <button onClick={()=>delSong(i)}>X</button>
              </div>);
        }
        if (screen === 'libraryVideo') {
          return videos.length === 0 ? <div>No hay videos.</div> :
            videos.map((v,i)=>
              <div key={i} className={`screen-item ${i===selected?'selected':''}`}>
                {v.title} <button onClick={()=>delVideo(i)}>X</button>
              </div>);
        }
        if (screen === 'addMusic' || screen === 'addVideo') {
          return <>
            T√≠tulo:<br/><input ref={titleRef}/><br/>
            URL MP3/YouTube:<br/><input ref={urlRef}/><br/>
            <button onClick={screen==='addMusic'?addSong:addVideo}>Guardar</button>
          </>
        }
        if (screen === 'nowPlaying') {
          return !current ? <div>No hay canci√≥n.</div> :
            <>
              <div><strong>{current.title}</strong></div>
              <div>{playing ? '‚ñ∂' : '‚ùô‚ùô'}</div>
              <div className="progress-bar"><div className="progress" style={{width:`${progress*100}%`}}></div></div>
            </>
        }
        if (screen === 'nowPlayingVideo') {
          return !currentVideo ? <div>No hay video.</div> :
            <iframe width="100%" height="120" src={currentVideo.url} frameBorder="0" allowFullScreen></iframe>;
        }
        if (screen === 'admin') {
          return Object.keys(localStorage).filter(k=>k.endsWith('_songs')).map(k=>{
            const user = k.split('_')[0];
            return <div key={user}>{user} <button onClick={()=>delPin(user)}>Borrar PIN</button></div>;
          });
        }
      };

      const addSong = () => {
        if (titleRef.current.value && urlRef.current.value) {
          const newS = [...songs, {title:titleRef.current.value, url:urlRef.current.value}];
          setSongs(newS); saveData(); alert('A√±adido!'); setScreen('menu');
        }
      };
      const addVideo = () => {
        if (titleRef.current.value && urlRef.current.value) {
          const newV = [...videos, {title:titleRef.current.value, url:urlRef.current.value}];
          setVideos(newV); saveData(); alert('A√±adido!'); setScreen('menu');
        }
      };

      const delSong = (i) => { const s = songs.filter((_,idx)=>idx!==i); setSongs(s); saveData(); };
      const delVideo = (i) => { const v = videos.filter((_,idx)=>idx!==i); setVideos(v); saveData(); };
      const delAll = () => { if(confirm('¬øSeguro?')) { setSongs([]); setVideos([]); saveData(); alert('Borrado!'); } };
      const delPin = (p) => { localStorage.removeItem(`${p}_songs`); localStorage.removeItem(`${p}_videos`); alert(`PIN ${p} borrado`); };

      const selectItem = () => {
        if (screen==='menu') {
          if (selected===0) setScreen('libraryMusic');
          else if (selected===1) setScreen('libraryVideo');
          else if (selected===2) setScreen('addMusic');
          else if (selected===3) setScreen('addVideo');
          else if (selected===4) delAll();
          else if (selected===5) setScreen('admin');
          setSelected(0);
        } else if (screen==='libraryMusic') {
          const s = songs[selected]; if (s) {
            setCurrent(s); audioRef.current.src=s.url; audioRef.current.play(); setPlaying(true); setScreen('nowPlaying');
          }
        } else if (screen==='libraryVideo') {
          const v = videos[selected]; if (v) {
            setCurrentVideo(v); setScreen('nowPlayingVideo');
          }
        }
      };

      const prevItem = () => setSelected(Math.max(0,selected-1));
      const nextItem = () => {
        let max = 0;
        if (screen==='menu') max = pin==='0000'?5:4;
        else if (screen==='libraryMusic') max=songs.length-1;
        else if (screen==='libraryVideo') max=videos.length-1;
        setSelected(Math.min(max,selected+1));
      };
      const togglePlay = () => { if(current) { playing ? audioRef.current.pause() : audioRef.current.play(); setPlaying(!playing); }};
      const wheelRef = useRef(null); let lastA=null;
      const startRotate = (e)=>{ e.preventDefault(); lastA=null; window.addEventListener('mousemove',rot); window.addEventListener('touchmove',t=>rot({clientX:t.touches[0].clientX,clientY:t.touches[0].clientY})); window.addEventListener('mouseup',stop); window.addEventListener('touchend',stop);};
      const stop = ()=>{window.removeEventListener('mousemove',rot);window.removeEventListener('touchmove',rot);};
      const rot = (e)=>{const r=wheelRef.current.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2,dx=e.clientX-cx,dy=e.clientY-cy,a=Math.atan2(dy,dx)*(180/Math.PI);if(lastA!==null){let d=a-lastA;if(d>180)d-=360;if(d<-180)d+=360;if(Math.abs(d)>10){d>0?nextItem():prevItem();}}lastA=a;};

      if (!loggedIn) return <div>PIN:<br/><input maxLength="4" pattern="\d*" value={pin} onChange={e=>setPin(e.target.value.replace(/\D/g,''))}/><br/><button onClick={handleLogin}>Entrar</button></div>;

      return <div className="ipod-shell">
        <div className="battery">{battery}</div>
        <div className="ipod-screen">{renderScreen()}</div>
        <div className="clickwheel" ref={wheelRef} onMouseDown={startRotate} onTouchStart={startRotate}>
          <div className="btn menu" onClick={()=>setScreen('menu')}>MENU</div>
          <div className="btn back" onClick={()=>audioRef.current.currentTime=0}>‚óÅ‚óÅ</div>
          <div className="btn forward" onClick={()=>audioRef.current.currentTime=audioRef.current.duration}>‚ñ∑‚ñ∑</div>
          <div className="btn play" onClick={togglePlay}>‚ñ∂‚ùô‚ùô</div>
          <div className="center-button" onClick={selectItem}></div>
        </div>
        <audio ref={audioRef}></audio>
      </div>;
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
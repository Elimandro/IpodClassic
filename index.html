<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>iPod Classic Clon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #bfc4c9, #a9aeb5);
      font-family: 'Courier New', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #login-screen {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #222;
      padding: 20px;
      border-radius: 10px;
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 20px;
    }
    #login-screen input {
      font-size: 20px;
      text-align: center;
    }
    #login-screen button {
      font-size: 18px;
      cursor: pointer;
    }
    .ipod-shell {
      width: 260px;
      height: 430px;
      background: linear-gradient(to bottom, #ccc, #aaa);
      border-radius: 40px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3), 0 10px 30px rgba(0,0,0,0.4);
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .ipod-screen {
      width: 200px;
      height: 150px;
      background: #111;
      border-radius: 12px;
      box-shadow: inset 0 0 8px rgba(0,255,0,0.3);
      color: #0f0;
      font-size: 12px;
      padding: 8px;
      margin-top: 16px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
    }
    #battery {
      position: absolute;
      top: 12px;
      right: 20px;
      font-size: 10px;
      color: #0f0;
      font-family: 'Courier New', monospace;
    }
    .clickwheel {
      width: 180px;
      height: 180px;
      background: radial-gradient(circle at center, #2c2c2c 0%, #000 70%);
      border-radius: 50%;
      margin-top: auto;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
      position: relative;
      cursor: pointer;
    }
    .clickwheel .btn {
      position: absolute;
      color: white;
      font-size: 10px;
      font-weight: bold;
    }
    .btn.menu { top: 10px; left: 50%; transform: translateX(-50%); }
    .btn.back { left: 10px; top: 50%; transform: translateY(-50%); }
    .btn.forward { right: 10px; top: 50%; transform: translateY(-50%); }
    .btn.play { bottom: 10px; left: 50%; transform: translateX(-50%); }
    .center-button {
      width: 60px; height: 60px;
      border-radius: 50%; background: #333;
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: inset 0 0 8px rgba(255,255,255,0.1);
      cursor: pointer;
    }
    input[type="text"] {
      width: 180px;
      font-size: 12px;
      margin: 5px 0;
    }
    button {
      font-size: 12px;
      cursor: pointer;
      margin-top: 5px;
    }
  </style>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="login-screen">
    <div>PIN:</div>
    <input id="pin-input" type="password" maxlength="4" />
    <button onclick="login()">Ingresar</button>
  </div>

  <!-- iPod -->
  <div class="ipod-shell" style="display:none;">
    <div id="battery">Bat: --%</div>
    <div class="ipod-screen" id="screen"></div>
    <div class="clickwheel">
      <div class="btn menu" onclick="showMenu()">MENU</div>
      <div class="btn back" onclick="prevItem()">◁◁</div>
      <div class="btn forward" onclick="nextItem()">▷▷</div>
      <div class="btn play" onclick="playSelected()">▶❙❙</div>
      <div class="center-button" onclick="selectItem()"></div>
    </div>
  </div>

<script>
let currentPin = null;
let userSongs = [];
let currentScreen = 'menu';
let selectedIndex = 0;
const screen = document.getElementById('screen');

function login() {
  const pin = document.getElementById('pin-input').value.trim();
  if (pin.length === 4) {
    currentPin = pin;
    loadUserSongs();
    document.getElementById('login-screen').style.display = 'none';
    document.querySelector('.ipod-shell').style.display = 'flex';
    showMenu();
    getBatteryStatus();
  } else {
    alert("PIN debe tener 4 dígitos");
  }
}

function loadUserSongs() {
  userSongs = JSON.parse(localStorage.getItem(currentPin)) || [];
}

function saveUserSongs() {
  localStorage.setItem(currentPin, JSON.stringify(userSongs));
}

function showMenu() {
  currentScreen = 'menu';
  selectedIndex = 0;
  renderMenu();
}

function renderMenu() {
  const items = ['▶ Biblioteca', '+ Añadir música'];
  let html = 'Menú Principal:<br>';
  items.forEach((item, i) => {
    html += (i === selectedIndex ? '> ' : '  ') + item + '<br>';
  });
  screen.innerHTML = html;
}

function renderLibrary() {
  currentScreen = 'library';
  selectedIndex = 0;
  let html = 'Biblioteca:<br>';
  if (userSongs.length === 0) {
    html += '  (Vacío)<br>';
  } else {
    userSongs.forEach((song, i) => {
      html += (i === selectedIndex ? '> ' : '  ') + song.title + '<br>';
    });
  }
  screen.innerHTML = html;
}

function renderAddMusic() {
  currentScreen = 'add';
  screen.innerHTML = `
    Añadir música:<br>
    <input id="yt-title" type="text" placeholder="Título"/><br>
    <input id="yt-url" type="text" placeholder="YouTube URL"/><br>
    <button onclick="addMusic()">Guardar</button><br>
    <small>URL no se descarga, solo se guarda.</small>
  `;
}

function nextItem() {
  if (currentScreen === 'menu' && selectedIndex < 1) selectedIndex++;
  if (currentScreen === 'library' && selectedIndex < userSongs.length -1) selectedIndex++;
  renderCurrent();
}

function prevItem() {
  if (selectedIndex > 0) selectedIndex--;
  renderCurrent();
}

function selectItem() {
  if (currentScreen === 'menu') {
    if (selectedIndex === 0) renderLibrary();
    if (selectedIndex === 1) renderAddMusic();
  } else if (currentScreen === 'library' && userSongs[selectedIndex]) {
    window.open(userSongs[selectedIndex].url, '_blank');
  }
}

function playSelected() {
  if (currentScreen === 'library' && userSongs[selectedIndex]) {
    window.open(userSongs[selectedIndex].url, '_blank');
  }
}

function addMusic() {
  const title = document.getElementById('yt-title').value.trim();
  const url = document.getElementById('yt-url').value.trim();
  if (title && url) {
    userSongs.push({title, url});
    saveUserSongs();
    alert('¡Guardado!');
    showMenu();
  } else {
    alert('Completa título y URL');
  }
}

function renderCurrent() {
  if (currentScreen === 'menu') renderMenu();
  else if (currentScreen === 'library') renderLibrary();
}

function getBatteryStatus() {
  if ('getBattery' in navigator) {
    navigator.getBattery().then(battery => {
      updateBattery(battery.level);
      battery.addEventListener('levelchange', () => {
        updateBattery(battery.level);
      });
    });
  } else {
    document.getElementById('battery').innerText = 'Bat: N/A';
  }
}

function updateBattery(level) {
  document.getElementById('battery').innerText = `Bat: ${Math.round(level * 100)}%`;
}

// ClickWheel real con rotación
let lastAngle = null;
const clickwheel = document.querySelector('.clickwheel');

clickwheel.addEventListener('mousedown', startRotate);
clickwheel.addEventListener('touchstart', startRotate);

function startRotate(e) {
  e.preventDefault();
  lastAngle = null;

  window.addEventListener('mousemove', rotate);
  window.addEventListener('touchmove', rotateTouch);
  window.addEventListener('mouseup', stopRotate);
  window.addEventListener('touchend', stopRotate);
}

function stopRotate() {
  window.removeEventListener('mousemove', rotate);
  window.removeEventListener('touchmove', rotateTouch);
  window.removeEventListener('mouseup', stopRotate);
  window.removeEventListener('touchend', stopRotate);
}

function rotateTouch(e) {
  const touch = e.touches[0];
  rotate({ clientX: touch.clientX, clientY: touch.clientY });
}

function rotate(e) {
  const rect = clickwheel.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;

  const dx = e.clientX - centerX;
  const dy = e.clientY - centerY;

  const angle = Math.atan2(dy, dx) * (180 / Math.PI);

  if (lastAngle !== null) {
    let diff = angle - lastAngle;

    if (diff > 180) diff -= 360;
    if (diff < -180) diff += 360;

    if (Math.abs(diff) > 10) {
      if (diff > 0) nextItem();
      else prevItem();
    }
  }

  lastAngle = angle;
}
</script>

</body>
</html>
